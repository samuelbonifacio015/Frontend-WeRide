<div class="booking-container">
  <div class="header">
    <h1>{{ 'booking.myBookings' | translate }}</h1>
    <button class="btn-primary" routerLink="/booking/form">
      <mat-icon>add</mat-icon>
      {{ 'booking.newBooking' | translate }}
    </button>
  </div>

  <div class="filters" *ngIf="!isLoading">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Buscar por vehículo</mat-label>
      <input matInput [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()" placeholder="Nombre del vehículo">
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline" class="sort-field">
      <mat-label>Ordenar por</mat-label>
      <mat-select [(ngModel)]="sortBy" (ngModelChange)="onSortChange()">
        <mat-option value="date">Fecha</mat-option>
        <mat-option value="vehicle">Vehículo</mat-option>
        <mat-option value="status">Estado</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="order-field">
      <mat-label>Orden</mat-label>
      <mat-select [(ngModel)]="sortOrder" (ngModelChange)="onSortChange()">
        <mat-option value="desc">Más recientes</mat-option>
        <mat-option value="asc">Más antiguos</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-icon-button (click)="clearFilters()" matTooltip="Limpiar filtros">
      <mat-icon>clear</mat-icon>
    </button>
  </div>

  <div *ngIf="isLoading" class="loading-state">
    <p>{{ 'booking.loadingBookings' | translate }}</p>
  </div>

  <div class="bookings-grid" *ngIf="!isLoading">
    <div class="booking-card" *ngFor="let booking of filteredBookings">
      <div class="booking-header">
        <h3>{{ booking.vehicleName }}</h3>
        <span
          class="status"
          [class.status-pending]="booking.status === 'pending'"
          [class.status-completed]="booking.status === 'completed'"
          [class.status-cancelled]="booking.status === 'cancelled'"
          [class.status-confirmed]="booking.status === 'confirmed'"
          [class.status-active]="booking.status === 'active'"
        >
          {{ 'booking.status.' + booking.status | translate }}
        </span>
      </div>
      <div class="booking-details">
        <div class="detail">
          <mat-icon>location_on</mat-icon>
          <span
            >{{ booking.startLocationName }} → {{ booking.endLocationName
            }}</span
          >
        </div>
        <div class="detail">
          <mat-icon>schedule</mat-icon>
          <span>{{ booking.startDate | date:'short' }}</span>
        </div>
        <div class="detail">
          <mat-icon>access_time</mat-icon>
          <span
            >{{ booking.duration || ('booking.notAvailable' | translate) }} {{
            'booking.minutes' | translate }}</span
          >
        </div>
        <div class="detail">
          <mat-icon>attach_money</mat-icon>
          <span
            >${{ booking.finalCost ? booking.finalCost.toFixed(2) :
            ('booking.notAvailable' | translate) }}</span
          >
        </div>
      </div>
      <div class="booking-actions">
        <button
          class="btn-activate"
          (click)="activateBooking(booking)"
          *ngIf="booking.status === 'pending' || booking.status === 'confirmed'"
          [disabled]="isActivating"
        >
          <mat-icon>play_circle_filled</mat-icon>
          {{ 'booking.activate' | translate }}
        </button>
        <button
          class="btn-secondary"
          (click)="editBooking(booking.id)"
          [disabled]="booking.status === 'completed' || booking.status === 'active'"
        >
          <mat-icon>edit</mat-icon>
          {{ 'booking.edit' | translate }}
        </button>
        <button
          class="btn-danger"
          (click)="cancelBooking(booking.id)"
          [disabled]="booking.status !== 'pending'"
        >
          <mat-icon>cancel</mat-icon>
          {{ 'booking.cancel' | translate }}
        </button>
        <button
          class="btn-danger-outline"
          (click)="deleteBooking(booking.id)"
          [disabled]="booking.status === 'active'"
        >
          <mat-icon>delete</mat-icon>
          {{ 'booking.delete' | translate }}
        </button>
      </div>
    </div>
  </div>

  <div class="empty-state" *ngIf="!isLoading && filteredBookings.length === 0">
    <mat-icon>book_online</mat-icon>
    <h2>{{ 'booking.noBookings' | translate }}</h2>
    <p>{{ 'booking.createFirstBooking' | translate }}</p>
    <button class="btn-primary" routerLink="/booking/form">
      <mat-icon>add</mat-icon>
      {{ 'booking.createBooking' | translate }}
    </button>
  </div>
</div>
